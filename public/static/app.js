// ============== TRANSLATIONS ==============
const translations = {
  al: {
    nav: {
      home: 'Kryefaqja',
      rooms: 'Akomodimi',
      wellness: 'Wellness',
      physiotherapy: 'Fizioterapi',
      gastronomy: 'Kuzhina',
      reviews: 'VlerÃ«sime',
      contact: 'Kontakt',
      book: 'Rezervo'
    },
    hero: {
      checkIn: 'Check-in',
      checkOut: 'Check-out',
      guests: 'VizitorÃ«',
      checkAvailability: 'Kontrollo DisponueshmÃ«rinÃ«',
      available: 'Kemi dhoma tÃ« lira! Rezervoni tani.',
      notAvailable: 'Na vjen keq, nuk kemi dhoma tÃ« lira pÃ«r kÃ«to data.',
      selectDates: 'Ju lutem zgjidhni datat'
    },
    rooms: {
      title: 'Akomodimi',
      subtitle: 'Zgjidhni dhomÃ«n tuaj tÃ« pÃ«rsosur',
      perPerson: 'pÃ«r person/natÃ«',
      bookNow: 'Rezervo Tani',
      capacity: 'Kapaciteti',
      persons: 'persona',
      amenities: 'Pajisjet'
    },
    wellness: {
      title: 'UjÃ«rat Termale',
      hot: 'Llixhat e Ngrohta',
      cold: 'Llixhat e Ftohta'
    },
    physio: {
      title: 'Fizioterapi',
      services: 'ShÃ«rbimet tona'
    },
    gastro: {
      title: 'Kuzhina Tradicionale Dibrane',
      subtitle: 'Shijoni gatimin autentik'
    },
    reviews: {
      title: 'Ã‡farÃ« thonÃ« mysafirÃ«t tanÃ«',
      subtitle: 'VlerÃ«sime nga Google Maps'
    },
    contact: {
      title: 'Kontakti',
      address: 'Adresa',
      addressText: 'Peshkopi, DibÃ«r, ShqipÃ«ri',
      phone: 'Telefon',
      email: 'Email',
      followUs: 'Na ndiqni'
    },
    footer: {
      rights: 'TÃ« gjitha tÃ« drejtat e rezervuara',
      quickLinks: 'Lidhje tÃ« Shpejta'
    }
  },
  en: {
    nav: {
      home: 'Home',
      rooms: 'Rooms',
      wellness: 'Wellness',
      physiotherapy: 'Physiotherapy',
      gastronomy: 'Cuisine',
      reviews: 'Reviews',
      contact: 'Contact',
      book: 'Book Now'
    },
    hero: {
      checkIn: 'Check-in',
      checkOut: 'Check-out',
      guests: 'Guests',
      checkAvailability: 'Check Availability',
      available: 'Rooms available! Book now.',
      notAvailable: 'Sorry, no rooms available for these dates.',
      selectDates: 'Please select dates'
    },
    rooms: {
      title: 'Accommodation',
      subtitle: 'Choose your perfect room',
      perPerson: 'per person/night',
      bookNow: 'Book Now',
      capacity: 'Capacity',
      persons: 'persons',
      amenities: 'Amenities'
    },
    wellness: {
      title: 'Thermal Waters',
      hot: 'Hot Thermal Baths',
      cold: 'Cold Medical Waters'
    },
    physio: {
      title: 'Physiotherapy',
      services: 'Our services'
    },
    gastro: {
      title: 'Traditional Dibran Cuisine',
      subtitle: 'Enjoy authentic cooking'
    },
    reviews: {
      title: 'What our guests say',
      subtitle: 'Reviews from Google Maps'
    },
    contact: {
      title: 'Contact',
      address: 'Address',
      addressText: 'Peshkopi, DibÃ«r, Albania',
      phone: 'Phone',
      email: 'Email',
      followUs: 'Follow us'
    },
    footer: {
      rights: 'All rights reserved',
      quickLinks: 'Quick Links'
    }
  },
  de: {
    nav: {
      home: 'Startseite',
      rooms: 'Zimmer',
      wellness: 'Wellness',
      physiotherapy: 'Physiotherapie',
      gastronomy: 'KÃ¼che',
      reviews: 'Bewertungen',
      contact: 'Kontakt',
      book: 'Buchen'
    },
    hero: {
      checkIn: 'Anreise',
      checkOut: 'Abreise',
      guests: 'GÃ¤ste',
      checkAvailability: 'VerfÃ¼gbarkeit prÃ¼fen',
      available: 'Zimmer verfÃ¼gbar! Jetzt buchen.',
      notAvailable: 'Leider keine Zimmer fÃ¼r diese Daten verfÃ¼gbar.',
      selectDates: 'Bitte wÃ¤hlen Sie Daten'
    },
    rooms: {
      title: 'Unterkunft',
      subtitle: 'WÃ¤hlen Sie Ihr perfektes Zimmer',
      perPerson: 'pro Person/Nacht',
      bookNow: 'Jetzt buchen',
      capacity: 'KapazitÃ¤t',
      persons: 'Personen',
      amenities: 'Ausstattung'
    },
    wellness: {
      title: 'Thermalwasser',
      hot: 'HeiÃŸe ThermalbÃ¤der',
      cold: 'Kalte Heilwasser'
    },
    physio: {
      title: 'Physiotherapie',
      services: 'Unsere Dienstleistungen'
    },
    gastro: {
      title: 'Traditionelle Dibran-KÃ¼che',
      subtitle: 'GenieÃŸen Sie authentische KÃ¼che'
    },
    reviews: {
      title: 'Was unsere GÃ¤ste sagen',
      subtitle: 'Bewertungen von Google Maps'
    },
    contact: {
      title: 'Kontakt',
      address: 'Adresse',
      addressText: 'Peshkopi, DibÃ«r, Albanien',
      phone: 'Telefon',
      email: 'E-Mail',
      followUs: 'Folgen Sie uns'
    },
    footer: {
      rights: 'Alle Rechte vorbehalten',
      quickLinks: 'Schnelle Links'
    }
  },
  it: {
    nav: {
      home: 'Home',
      rooms: 'Camere',
      wellness: 'Wellness',
      physiotherapy: 'Fisioterapia',
      gastronomy: 'Cucina',
      reviews: 'Recensioni',
      contact: 'Contatto',
      book: 'Prenota'
    },
    hero: {
      checkIn: 'Check-in',
      checkOut: 'Check-out',
      guests: 'Ospiti',
      checkAvailability: 'Verifica disponibilitÃ ',
      available: 'Camere disponibili! Prenota ora.',
      notAvailable: 'Spiacenti, nessuna camera disponibile per queste date.',
      selectDates: 'Seleziona le date'
    },
    rooms: {
      title: 'Alloggio',
      subtitle: 'Scegli la tua camera perfetta',
      perPerson: 'per persona/notte',
      bookNow: 'Prenota Ora',
      capacity: 'CapacitÃ ',
      persons: 'persone',
      amenities: 'Servizi'
    },
    wellness: {
      title: 'Acque Termali',
      hot: 'Bagni Termali Caldi',
      cold: 'Acque Medicinali Fredde'
    },
    physio: {
      title: 'Fisioterapia',
      services: 'I nostri servizi'
    },
    gastro: {
      title: 'Cucina Tradizionale Dibrana',
      subtitle: 'Gustate la cucina autentica'
    },
    reviews: {
      title: 'Cosa dicono i nostri ospiti',
      subtitle: 'Recensioni da Google Maps'
    },
    contact: {
      title: 'Contatto',
      address: 'Indirizzo',
      addressText: 'Peshkopi, DibÃ«r, Albania',
      phone: 'Telefono',
      email: 'Email',
      followUs: 'Seguici'
    },
    footer: {
      rights: 'Tutti i diritti riservati',
      quickLinks: 'Link Rapidi'
    }
  },
  fr: {
    nav: {
      home: 'Accueil',
      rooms: 'Chambres',
      wellness: 'Bien-Ãªtre',
      physiotherapy: 'PhysiothÃ©rapie',
      gastronomy: 'Cuisine',
      reviews: 'Avis',
      contact: 'Contact',
      book: 'RÃ©server'
    },
    hero: {
      checkIn: 'ArrivÃ©e',
      checkOut: 'DÃ©part',
      guests: 'Personnes',
      checkAvailability: 'VÃ©rifier disponibilitÃ©',
      available: 'Chambres disponibles! RÃ©servez maintenant.',
      notAvailable: 'DÃ©solÃ©, pas de chambres disponibles pour ces dates.',
      selectDates: 'Veuillez sÃ©lectionner les dates'
    },
    rooms: {
      title: 'HÃ©bergement',
      subtitle: 'Choisissez votre chambre parfaite',
      perPerson: 'par personne/nuit',
      bookNow: 'RÃ©server',
      capacity: 'CapacitÃ©',
      persons: 'personnes',
      amenities: 'Ã‰quipements'
    },
    wellness: {
      title: 'Eaux Thermales',
      hot: 'Bains Thermaux Chauds',
      cold: 'Eaux MÃ©dicinales Froides'
    },
    physio: {
      title: 'PhysiothÃ©rapie',
      services: 'Nos services'
    },
    gastro: {
      title: 'Cuisine Traditionnelle de Dibran',
      subtitle: 'Savourez la cuisine authentique'
    },
    reviews: {
      title: 'Ce que disent nos clients',
      subtitle: 'Avis de Google Maps'
    },
    contact: {
      title: 'Contact',
      address: 'Adresse',
      addressText: 'Peshkopi, DibÃ«r, Albanie',
      phone: 'TÃ©lÃ©phone',
      email: 'Email',
      followUs: 'Suivez-nous'
    },
    footer: {
      rights: 'Tous droits rÃ©servÃ©s',
      quickLinks: 'Liens Rapides'
    }
  }
};

// ============== STATE ==============
let currentLang = localStorage.getItem('lang') || 'al';
let content = {};
let rooms = [];
let reviews = [];
let posts = [];
let menuOpen = false;

// ============== UTILITY FUNCTIONS ==============
const t = (key) => {
  const keys = key.split('.');
  let value = translations[currentLang];
  for (const k of keys) {
    value = value?.[k];
  }
  return value || key;
};

const getLocalizedText = (obj) => {
  if (!obj) return '';
  return obj[currentLang] || obj.al || obj.en || '';
};

const amenityIcons = {
  wifi: '<i class="fas fa-wifi"></i>',
  tv: '<i class="fas fa-tv"></i>',
  heating: '<i class="fas fa-temperature-high"></i>',
  bathroom: '<i class="fas fa-bath"></i>',
  balcony: '<i class="fas fa-door-open"></i>',
  'mountain-view': '<i class="fas fa-mountain"></i>',
  minibar: '<i class="fas fa-glass-martini-alt"></i>',
  safe: '<i class="fas fa-lock"></i>'
};

const amenityNames = {
  al: { wifi: 'WiFi', tv: 'TV', heating: 'Ngrohje', bathroom: 'BanjÃ«', balcony: 'Ballkon', 'mountain-view': 'Pamje malore', minibar: 'Minibar', safe: 'KasafortÃ«' },
  en: { wifi: 'WiFi', tv: 'TV', heating: 'Heating', bathroom: 'Bathroom', balcony: 'Balcony', 'mountain-view': 'Mountain view', minibar: 'Minibar', safe: 'Safe' },
  de: { wifi: 'WLAN', tv: 'TV', heating: 'Heizung', bathroom: 'Bad', balcony: 'Balkon', 'mountain-view': 'Bergblick', minibar: 'Minibar', safe: 'Safe' },
  it: { wifi: 'WiFi', tv: 'TV', heating: 'Riscaldamento', bathroom: 'Bagno', balcony: 'Balcone', 'mountain-view': 'Vista montagna', minibar: 'Minibar', safe: 'Cassaforte' },
  fr: { wifi: 'WiFi', tv: 'TV', heating: 'Chauffage', bathroom: 'Salle de bain', balcony: 'Balcon', 'mountain-view': 'Vue montagne', minibar: 'Minibar', safe: 'Coffre-fort' }
};

// ============== FETCH DATA ==============
async function fetchData() {
  try {
    const [contentRes, roomsRes, reviewsRes, postsRes] = await Promise.all([
      fetch('/api/content'),
      fetch('/api/rooms'),
      fetch('/api/reviews'),
      fetch('/api/posts')
    ]);
    content = await contentRes.json();
    rooms = await roomsRes.json();
    reviews = await reviewsRes.json();
    posts = await postsRes.json();
  } catch (error) {
    console.error('Error fetching data:', error);
  }
}

// ============== CAROUSEL COMPONENT ==============
function createCarousel(images, containerId) {
  const container = document.getElementById(containerId);
  if (!container || !images || images.length === 0) return;
  
  // Filter out empty strings
  const validImages = images.filter(img => img && img.trim() !== '');
  if (validImages.length === 0) return;
  
  container.innerHTML = `
    <div class="relative overflow-hidden rounded-xl">
      <div class="flex transition-transform duration-500 ease-in-out" id="${containerId}-track" style="width: ${validImages.length * 100}%;">
        ${validImages.map((img, i) => `
          <div class="flex-shrink-0" style="width: ${100 / validImages.length}%;">
            <img src="${img}" alt="Image ${i + 1}" class="w-full h-64 md:h-80 object-cover" onerror="this.src='https://images.unsplash.com/photo-1566665797739-1674de7a421a?w=800'">
          </div>
        `).join('')}
      </div>
      ${validImages.length > 1 ? `
        <button onclick="prevSlide('${containerId}')" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-emerald-700 w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition z-10">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button onclick="nextSlide('${containerId}')" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-emerald-700 w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition z-10">
          <i class="fas fa-chevron-right"></i>
        </button>
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10">
          ${validImages.map((_, i) => `<button onclick="goToSlide('${containerId}', ${i})" class="w-3 h-3 rounded-full ${i === 0 ? 'bg-white' : 'bg-white/50'} hover:bg-white transition" id="${containerId}-dot-${i}"></button>`).join('')}
        </div>
        <div class="absolute top-3 right-3 bg-black/50 text-white text-xs px-2 py-1 rounded-full z-10">
          <span id="${containerId}-counter">1</span>/${validImages.length}
        </div>
      ` : ''}
    </div>
  `;
  
  window[`${containerId}Index`] = 0;
  window[`${containerId}Total`] = validImages.length;
}

window.goToSlide = (containerId, index) => {
  slideCarousel(containerId, index);
};

function slideCarousel(containerId, index) {
  const track = document.getElementById(`${containerId}-track`);
  if (!track) return;
  
  const totalItems = window[`${containerId}Total`] || 1;
  
  if (index >= totalItems) index = 0;
  if (index < 0) index = totalItems - 1;
  
  window[`${containerId}Index`] = index;
  
  // Calculate the translate percentage based on total items
  const translatePercent = (index * 100) / totalItems;
  track.style.transform = `translateX(-${translatePercent}%)`;
  
  // Update dots
  for (let i = 0; i < totalItems; i++) {
    const dot = document.getElementById(`${containerId}-dot-${i}`);
    if (dot) {
      dot.className = `w-3 h-3 rounded-full ${i === index ? 'bg-white' : 'bg-white/50'} hover:bg-white transition`;
    }
  }
  
  // Update counter
  const counter = document.getElementById(`${containerId}-counter`);
  if (counter) {
    counter.textContent = index + 1;
  }
}

window.prevSlide = (containerId) => {
  const currentIndex = window[`${containerId}Index`] || 0;
  slideCarousel(containerId, currentIndex - 1);
};

window.nextSlide = (containerId) => {
  const currentIndex = window[`${containerId}Index`] || 0;
  slideCarousel(containerId, currentIndex + 1);
};

// Auto-slide for wellness and gastro carousels
function startAutoSlide(containerId) {
  setInterval(() => {
    const currentIndex = window[`${containerId}Index`] || 0;
    slideCarousel(containerId, currentIndex + 1);
  }, 5000);
}

// ============== RENDER FUNCTIONS ==============
function renderApp() {
  const app = document.getElementById('app');
  app.innerHTML = `
    ${renderNavigation()}
    ${renderHero()}
    ${renderRooms()}
    ${renderNews()}
    ${renderWellness()}
    ${renderPhysiotherapy()}
    ${renderGastronomy()}
    ${renderReviews()}
    ${renderContact()}
    ${renderFooter()}
    ${renderFloatingButtons()}
    ${renderMobileMenu()}
  `;
  
  // Initialize carousels
  setTimeout(() => {
    rooms.forEach((room, i) => createCarousel(room.images, `room-carousel-${i}`));
    createCarousel(content.wellness?.images || [], 'wellness-carousel');
    createCarousel(content.gastronomy?.images || [], 'gastro-carousel');
    createReviewsCarousel();
    startAutoSlide('wellness-carousel');
    startAutoSlide('gastro-carousel');
  }, 100);
}

function renderNavigation() {
  return `
    <nav class="fixed top-0 left-0 right-0 z-50 glass shadow-sm">
      <div class="max-w-7xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <!-- Language Selector -->
          <div class="flex items-center gap-2">
            <select onchange="changeLang(this.value)" class="bg-emerald-50 border border-emerald-200 text-emerald-800 text-sm rounded-lg px-3 py-2 focus:ring-emerald-500 focus:border-emerald-500 cursor-pointer">
              <option value="al" ${currentLang === 'al' ? 'selected' : ''}>ðŸ‡¦ðŸ‡± AL</option>
              <option value="en" ${currentLang === 'en' ? 'selected' : ''}>ðŸ‡¬ðŸ‡§ EN</option>
              <option value="de" ${currentLang === 'de' ? 'selected' : ''}>ðŸ‡©ðŸ‡ª DE</option>
              <option value="it" ${currentLang === 'it' ? 'selected' : ''}>ðŸ‡®ðŸ‡¹ IT</option>
              <option value="fr" ${currentLang === 'fr' ? 'selected' : ''}>ðŸ‡«ðŸ‡· FR</option>
            </select>
          </div>
          
          <!-- Logo -->
          <a href="#" class="flex items-center gap-2">
            <div class="w-10 h-10 bg-emerald-600 rounded-full flex items-center justify-center">
              <i class="fas fa-spa text-white text-lg"></i>
            </div>
            <span class="font-serif text-lg font-bold text-emerald-800 hidden md:block">Hotel Termal</span>
          </a>
          
          <!-- Desktop Nav -->
          <div class="hidden lg:flex items-center gap-6">
            <a href="#rooms" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.rooms')}</a>
            <a href="#wellness" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.wellness')}</a>
            <a href="#physio" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.physiotherapy')}</a>
            <a href="#gastro" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.gastronomy')}</a>
            <a href="#reviews" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.reviews')}</a>
            <a href="#contact" class="text-gray-700 hover:text-emerald-600 transition text-sm font-medium">${t('nav.contact')}</a>
          </div>
          
          <!-- Menu Button -->
          <button onclick="toggleMenu()" class="lg:hidden w-10 h-10 flex items-center justify-center text-emerald-700">
            <i class="fas fa-bars text-xl"></i>
          </button>
        </div>
      </div>
    </nav>
  `;
}

function renderMobileMenu() {
  return `
    <div id="mobile-menu" class="fixed inset-0 z-[100] bg-black/50 hidden" onclick="toggleMenu()">
      <div class="absolute right-0 top-0 bottom-0 w-72 bg-white shadow-2xl transform transition-transform" onclick="event.stopPropagation()">
        <div class="p-6">
          <div class="flex justify-between items-center mb-8">
            <span class="font-serif text-xl font-bold text-emerald-800">Menu</span>
            <button onclick="toggleMenu()" class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-gray-700">
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <nav class="space-y-4">
            <a href="#" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-home mr-3 text-emerald-600"></i>${t('nav.home')}
            </a>
            <a href="#rooms" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-bed mr-3 text-emerald-600"></i>${t('nav.rooms')}
            </a>
            <a href="#wellness" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-spa mr-3 text-emerald-600"></i>${t('nav.wellness')}
            </a>
            <a href="#physio" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-hand-holding-medical mr-3 text-emerald-600"></i>${t('nav.physiotherapy')}
            </a>
            <a href="#gastro" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-utensils mr-3 text-emerald-600"></i>${t('nav.gastronomy')}
            </a>
            <a href="#reviews" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-star mr-3 text-emerald-600"></i>${t('nav.reviews')}
            </a>
            <a href="#contact" onclick="toggleMenu()" class="block py-3 px-4 rounded-lg hover:bg-emerald-50 text-gray-700 font-medium transition">
              <i class="fas fa-envelope mr-3 text-emerald-600"></i>${t('nav.contact')}
            </a>
          </nav>
        </div>
      </div>
    </div>
  `;
}

window.toggleMenu = () => {
  const menu = document.getElementById('mobile-menu');
  menu.classList.toggle('hidden');
};

function renderHero() {
  const heroImage = content.hero?.image || 'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=1920';
  return `
    <section class="relative min-h-screen flex items-center justify-center pt-16" style="background: url('${heroImage}') center/cover no-repeat;">
      <div class="absolute inset-0 hero-gradient"></div>
      <div class="relative z-10 text-center text-white px-4 max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-6xl font-serif font-bold mb-4 drop-shadow-lg fade-in">
          ${getLocalizedText(content.hero?.title) || 'Hotel Termal Peshkopi'}
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-white/90 drop-shadow fade-in">
          ${getLocalizedText(content.hero?.subtitle) || t('hero.checkAvailability')}
        </p>
        
        <!-- Booking Widget -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-3xl mx-auto fade-in">
          <form id="availability-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="text-left">
              <label class="block text-sm font-medium text-gray-600 mb-1">${t('hero.checkIn')}</label>
              <input type="date" id="checkin" required class="w-full px-4 py-3 border border-gray-200 rounded-lg text-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
            </div>
            <div class="text-left">
              <label class="block text-sm font-medium text-gray-600 mb-1">${t('hero.checkOut')}</label>
              <input type="date" id="checkout" required class="w-full px-4 py-3 border border-gray-200 rounded-lg text-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
            </div>
            <div class="text-left">
              <label class="block text-sm font-medium text-gray-600 mb-1">${t('hero.guests')}</label>
              <select id="guests" class="w-full px-4 py-3 border border-gray-200 rounded-lg text-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5+</option>
              </select>
            </div>
            <div class="flex items-end">
              <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition shadow-lg hover:shadow-xl">
                ${t('hero.checkAvailability')}
              </button>
            </div>
          </form>
          <div id="availability-result" class="mt-4 hidden"></div>
        </div>
      </div>
      
      <!-- Scroll indicator -->
      <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
        <a href="#rooms" class="text-white/80 hover:text-white">
          <i class="fas fa-chevron-down text-2xl"></i>
        </a>
      </div>
    </section>
  `;
}

function renderRooms() {
  return `
    <section id="rooms" class="py-20 bg-beige-50">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-4">${t('rooms.title')}</h2>
          <p class="text-gray-600 text-lg">${t('rooms.subtitle')}</p>
          <div class="w-24 h-1 bg-emerald-500 mx-auto mt-4 rounded-full"></div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          ${rooms.map((room, i) => `
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow group">
              <div id="room-carousel-${i}" class="relative"></div>
              <div class="p-6">
                <div class="flex justify-between items-start mb-3">
                  <h3 class="text-xl font-serif font-bold text-emerald-800">${getLocalizedText(room.name)}</h3>
                  <div class="text-right">
                    <span class="text-2xl font-bold text-emerald-600">â‚¬${room.pricePerPerson}</span>
                    <span class="text-sm text-gray-500 block">${t('rooms.perPerson')}</span>
                  </div>
                </div>
                <p class="text-gray-600 mb-4 text-sm">${getLocalizedText(room.description)}</p>
                <div class="flex items-center gap-2 mb-4 text-sm text-gray-500">
                  <i class="fas fa-user-friends text-emerald-600"></i>
                  <span>${t('rooms.capacity')}: ${room.capacity} ${t('rooms.persons')}</span>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                  ${room.amenities.map(a => `
                    <span class="inline-flex items-center gap-1 px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs">
                      ${amenityIcons[a] || ''} ${amenityNames[currentLang]?.[a] || a}
                    </span>
                  `).join('')}
                </div>
                <a href="https://wa.me/355684340580?text=${encodeURIComponent(`PÃ«rshÃ«ndetje! Dua tÃ« rezervoj: ${getLocalizedText(room.name)}`)}" 
                   target="_blank"
                   class="block w-full bg-emerald-600 hover:bg-emerald-700 text-white text-center font-semibold py-3 rounded-lg transition">
                  <i class="fab fa-whatsapp mr-2"></i>${t('rooms.bookNow')}
                </a>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    </section>
  `;
}

// ============== NEWS/BLOG SECTION ==============
function renderNews() {
  // Only show latest 3 posts
  const latestPosts = posts.slice(0, 3);
  
  if (latestPosts.length === 0) {
    return ''; // Don't render section if no posts
  }
  
  const newsTranslations = {
    al: { title: 'TÃ« Rejat', subtitle: 'Lajmet dhe artikujt mÃ« tÃ« fundit', readMore: 'Lexo MÃ« ShumÃ«', viewAll: 'Shiko tÃ« gjitha' },
    en: { title: 'News', subtitle: 'Latest news and articles', readMore: 'Read More', viewAll: 'View All' },
    de: { title: 'Neuigkeiten', subtitle: 'Neueste Nachrichten und Artikel', readMore: 'Mehr lesen', viewAll: 'Alle anzeigen' },
    it: { title: 'NovitÃ ', subtitle: 'Ultime notizie e articoli', readMore: 'Leggi di piÃ¹', viewAll: 'Vedi tutti' },
    fr: { title: 'ActualitÃ©s', subtitle: 'DerniÃ¨res nouvelles et articles', readMore: 'Lire la suite', viewAll: 'Voir tout' }
  };
  
  const newsT = newsTranslations[currentLang] || newsTranslations.al;
  
  return `
    <section id="news" class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-12">
          <div class="text-center md:text-left">
            <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-4">${newsT.title}</h2>
            <p class="text-gray-600 text-lg">${newsT.subtitle}</p>
            <div class="w-24 h-1 bg-emerald-500 mt-4 rounded-full mx-auto md:mx-0"></div>
          </div>
          <a href="/blog" class="mt-6 md:mt-0 inline-flex items-center justify-center gap-2 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition shadow-lg hover:shadow-xl mx-auto md:mx-0">
            ${newsT.viewAll}
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          ${latestPosts.map(post => {
            const hasImage = post.image && post.image.trim() !== '';
            return `
              <article class="bg-beige-50 rounded-2xl shadow-md overflow-hidden hover:shadow-xl transition-shadow group">
                ${hasImage ? `
                  <a href="/blog/${post.slug}" class="block overflow-hidden">
                    <img src="${post.image}" alt="${getLocalizedText(post.title)}" 
                         class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                         onerror="this.style.display='none'">
                  </a>
                ` : `
                  <div class="h-4 bg-gradient-to-r from-emerald-500 to-emerald-600"></div>
                `}
                <div class="p-6">
                  <div class="flex items-center gap-2 text-sm text-emerald-600 mb-3">
                    <i class="far fa-calendar-alt"></i>
                    <time datetime="${post.date}">${new Date(post.date).toLocaleDateString(currentLang === 'al' ? 'sq-AL' : currentLang, { year: 'numeric', month: 'long', day: 'numeric' })}</time>
                  </div>
                  <h3 class="font-serif font-bold text-xl text-emerald-800 mb-3 group-hover:text-emerald-600 transition-colors">
                    <a href="/blog/${post.slug}">${getLocalizedText(post.title)}</a>
                  </h3>
                  <p class="text-gray-600 text-sm mb-4 line-clamp-3">${getLocalizedText(post.excerpt)}</p>
                  <a href="/blog/${post.slug}" 
                     class="inline-flex items-center gap-2 text-emerald-600 hover:text-emerald-700 font-medium text-sm transition">
                    ${newsT.readMore}
                    <i class="fas fa-arrow-right text-xs"></i>
                  </a>
                </div>
              </article>
            `;
          }).join('')}
        </div>
      </div>
    </section>
  `;
}

function renderWellness() {
  return `
    <section id="wellness" class="py-20 bg-gradient-to-br from-emerald-50 to-beige-100">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-4">${t('wellness.title')}</h2>
          <div class="w-24 h-1 bg-emerald-500 mx-auto rounded-full"></div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <div id="wellness-carousel" class="order-2 lg:order-1"></div>
          
          <div class="order-1 lg:order-2 space-y-8">
            <!-- Hot Baths -->
            <div class="bg-white rounded-2xl p-6 shadow-lg">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-temperature-high text-orange-500 text-xl"></i>
                </div>
                <h3 class="text-xl font-serif font-bold text-emerald-800">${getLocalizedText(content.wellness?.hotBaths?.title) || t('wellness.hot')}</h3>
              </div>
              <p class="text-gray-600 leading-relaxed">${getLocalizedText(content.wellness?.hotBaths?.description)}</p>
            </div>
            
            <!-- Cold Baths -->
            <div class="bg-white rounded-2xl p-6 shadow-lg">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-snowflake text-blue-500 text-xl"></i>
                </div>
                <h3 class="text-xl font-serif font-bold text-emerald-800">${getLocalizedText(content.wellness?.coldBaths?.title) || t('wellness.cold')}</h3>
              </div>
              <p class="text-gray-600 leading-relaxed">${getLocalizedText(content.wellness?.coldBaths?.description)}</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  `;
}

function renderPhysiotherapy() {
  const services = content.physiotherapy?.services || [];
  return `
    <section id="physio" class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-4">${getLocalizedText(content.physiotherapy?.title) || t('physio.title')}</h2>
          <p class="text-gray-600 text-lg max-w-2xl mx-auto">${getLocalizedText(content.physiotherapy?.description)}</p>
          <div class="w-24 h-1 bg-emerald-500 mx-auto mt-4 rounded-full"></div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          ${services.map((service, i) => `
            <div class="bg-emerald-50 rounded-xl p-6 flex items-center gap-4 hover:bg-emerald-100 transition group">
              <div class="w-12 h-12 bg-emerald-600 rounded-full flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <i class="fas fa-check text-white"></i>
              </div>
              <span class="text-gray-700 font-medium">${getLocalizedText(service)}</span>
            </div>
          `).join('')}
        </div>
        
        <div class="text-center mt-10">
          <a href="https://wa.me/355684340580?text=${encodeURIComponent('PÃ«rshÃ«ndetje! Dua informacion pÃ«r shÃ«rbimet e fizioterapisÃ«.')}" 
             target="_blank"
             class="inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-8 rounded-lg transition shadow-lg hover:shadow-xl">
            <i class="fab fa-whatsapp text-xl"></i>
            ${t('nav.book')}
          </a>
        </div>
      </div>
    </section>
  `;
}

function renderGastronomy() {
  return `
    <section id="gastro" class="py-20 bg-beige-100">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <div>
            <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-6">${getLocalizedText(content.gastronomy?.title) || t('gastro.title')}</h2>
            <div class="w-24 h-1 bg-emerald-500 mb-6 rounded-full"></div>
            <p class="text-gray-600 text-lg leading-relaxed mb-8">${getLocalizedText(content.gastronomy?.description)}</p>
            
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-white rounded-xl p-4 text-center shadow">
                <i class="fas fa-leaf text-emerald-500 text-2xl mb-2"></i>
                <p class="text-sm text-gray-600">Produkte lokale</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center shadow">
                <i class="fas fa-utensils text-emerald-500 text-2xl mb-2"></i>
                <p class="text-sm text-gray-600">Receta tradicionale</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center shadow">
                <i class="fas fa-seedling text-emerald-500 text-2xl mb-2"></i>
                <p class="text-sm text-gray-600">Organike</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center shadow">
                <i class="fas fa-heart text-emerald-500 text-2xl mb-2"></i>
                <p class="text-sm text-gray-600">Me dashuri</p>
              </div>
            </div>
          </div>
          
          <div id="gastro-carousel"></div>
        </div>
      </div>
    </section>
  `;
}

function renderReviews() {
  return `
    <section id="reviews" class="py-20 bg-emerald-700">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-white mb-4">${t('reviews.title')}</h2>
          <p class="text-emerald-100">${t('reviews.subtitle')}</p>
          <div class="w-24 h-1 bg-white/50 mx-auto mt-4 rounded-full"></div>
        </div>
        
        <div id="reviews-carousel" class="relative overflow-hidden">
          <div class="flex gap-6 transition-transform duration-500" id="reviews-track">
            ${reviews.map(review => `
              <div class="bg-white rounded-2xl p-6 shadow-lg min-w-[300px] md:min-w-[350px] flex-shrink-0">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center">
                    <span class="text-emerald-700 font-bold text-lg">${review.name.charAt(0)}</span>
                  </div>
                  <div>
                    <p class="font-semibold text-gray-800">${review.name}</p>
                    <div class="flex text-yellow-400">
                      ${Array(review.rating).fill('<i class="fas fa-star text-sm"></i>').join('')}
                    </div>
                  </div>
                </div>
                <p class="text-gray-600 italic">"${getLocalizedText(review.text)}"</p>
                <p class="text-sm text-gray-400 mt-3"><i class="fab fa-google mr-1"></i>Google Maps</p>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="flex justify-center gap-4 mt-8">
          <button onclick="prevReview()" class="w-12 h-12 bg-white/20 hover:bg-white/30 text-white rounded-full flex items-center justify-center transition">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button onclick="nextReview()" class="w-12 h-12 bg-white/20 hover:bg-white/30 text-white rounded-full flex items-center justify-center transition">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </section>
  `;
}

let reviewIndex = 0;
function createReviewsCarousel() {
  const track = document.getElementById('reviews-track');
  if (!track) return;
  
  // Auto-scroll reviews
  setInterval(() => {
    reviewIndex = (reviewIndex + 1) % reviews.length;
    const offset = reviewIndex * 366; // card width + gap
    track.style.transform = `translateX(-${offset}px)`;
  }, 4000);
}

window.prevReview = () => {
  reviewIndex = reviewIndex > 0 ? reviewIndex - 1 : reviews.length - 1;
  const track = document.getElementById('reviews-track');
  const offset = reviewIndex * 366;
  track.style.transform = `translateX(-${offset}px)`;
};

window.nextReview = () => {
  reviewIndex = (reviewIndex + 1) % reviews.length;
  const track = document.getElementById('reviews-track');
  const offset = reviewIndex * 366;
  track.style.transform = `translateX(-${offset}px)`;
};

function renderContact() {
  return `
    <section id="contact" class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-emerald-800 mb-4">${t('contact.title')}</h2>
          <div class="w-24 h-1 bg-emerald-500 mx-auto rounded-full"></div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
          <!-- Map -->
          <div class="rounded-2xl overflow-hidden shadow-lg h-[400px]">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2961.1234567890!2d20.4264!3d41.6819!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sHotel%20Termal%20Peshkopi!5e0!3m2!1sen!2s!4v1234567890"
              width="100%" 
              height="100%" 
              style="border:0;" 
              allowfullscreen="" 
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          </div>
          
          <!-- Contact Info -->
          <div class="space-y-8">
            <div class="flex items-start gap-4">
              <div class="w-14 h-14 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-map-marker-alt text-emerald-600 text-xl"></i>
              </div>
              <div>
                <h3 class="font-semibold text-gray-800 text-lg">${t('contact.address')}</h3>
                <p class="text-gray-600">${t('contact.addressText')}</p>
              </div>
            </div>
            
            <div class="flex items-start gap-4">
              <div class="w-14 h-14 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-phone text-emerald-600 text-xl"></i>
              </div>
              <div>
                <h3 class="font-semibold text-gray-800 text-lg">${t('contact.phone')}</h3>
                <div class="space-y-1">
                  <a href="tel:+355684340580" class="text-emerald-600 hover:underline text-lg font-medium block">+355 68 434 0580</a>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded">RezervÃ«</span>
                    <a href="tel:+355672020218" class="text-emerald-600 hover:underline text-sm">+355 67 202 0218</a>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded">RezervÃ«</span>
                    <a href="tel:+355682321806" class="text-emerald-600 hover:underline text-sm">+355 68 232 1806</a>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="flex items-start gap-4">
              <div class="w-14 h-14 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-envelope text-emerald-600 text-xl"></i>
              </div>
              <div>
                <h3 class="font-semibold text-gray-800 text-lg">${t('contact.email')}</h3>
                <a href="mailto:hotel.termal.peshkopi@gmail.com" class="text-emerald-600 hover:underline">hotel.termal.peshkopi@gmail.com</a>
              </div>
            </div>
            
            <div class="pt-6 border-t border-gray-200">
              <h3 class="font-semibold text-gray-800 text-lg mb-4">${t('contact.followUs')}</h3>
              <div class="flex gap-4">
                <a href="https://www.facebook.com/hoteltermal/?locale=sq_AL" target="_blank" rel="noopener noreferrer"
                   class="w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition transform hover:scale-110"
                   onclick="window.open('https://www.facebook.com/hoteltermal/?locale=sq_AL', '_blank'); return false;">
                  <i class="fab fa-facebook-f text-2xl"></i>
                </a>
                <a href="https://www.instagram.com/hotel_termal/" target="_blank" rel="noopener noreferrer"
                   class="w-14 h-14 bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 hover:opacity-90 text-white rounded-full flex items-center justify-center transition transform hover:scale-110"
                   onclick="window.open('https://www.instagram.com/hotel_termal/', '_blank'); return false;">
                  <i class="fab fa-instagram text-2xl"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  `;
}

function renderFooter() {
  return `
    <footer class="bg-emerald-900 text-white py-12">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Logo & About -->
          <div>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 bg-emerald-600 rounded-full flex items-center justify-center">
                <i class="fas fa-spa text-white text-xl"></i>
              </div>
              <span class="font-serif text-xl font-bold">Hotel Termal Peshkopi</span>
            </div>
            <p class="text-emerald-200 text-sm">
              ${getLocalizedText(content.hero?.subtitle) || 'Relaksim dhe shÃ«ndet nÃ« zemÃ«r tÃ« Alpeve Shqiptare'}
            </p>
          </div>
          
          <!-- Quick Links -->
          <div>
            <h4 class="font-semibold text-lg mb-4">${t('footer.quickLinks')}</h4>
            <nav class="space-y-2">
              <a href="#rooms" class="block text-emerald-200 hover:text-white transition">${t('nav.rooms')}</a>
              <a href="#wellness" class="block text-emerald-200 hover:text-white transition">${t('nav.wellness')}</a>
              <a href="#physio" class="block text-emerald-200 hover:text-white transition">${t('nav.physiotherapy')}</a>
              <a href="#gastro" class="block text-emerald-200 hover:text-white transition">${t('nav.gastronomy')}</a>
              <a href="#contact" class="block text-emerald-200 hover:text-white transition">${t('nav.contact')}</a>
            </nav>
          </div>
          
          <!-- Contact -->
          <div>
            <h4 class="font-semibold text-lg mb-4">${t('contact.title')}</h4>
            <div class="space-y-3 text-emerald-200">
              <div>
                <p><i class="fas fa-phone mr-2"></i>+355 68 434 0580</p>
                <p class="text-sm mt-1 text-emerald-300 pl-6"><span class="text-xs bg-emerald-700 px-1.5 py-0.5 rounded mr-1">RezervÃ«</span>+355 67 202 0218</p>
                <p class="text-sm mt-1 text-emerald-300 pl-6"><span class="text-xs bg-emerald-700 px-1.5 py-0.5 rounded mr-1">RezervÃ«</span>+355 68 232 1806</p>
              </div>
              <p><i class="fas fa-envelope mr-2"></i>hotel.termal.peshkopi@gmail.com</p>
              <p><i class="fas fa-map-marker-alt mr-2"></i>${t('contact.addressText')}</p>
            </div>
          </div>
        </div>
        
        <div class="border-t border-emerald-800 mt-8 pt-8 text-center text-emerald-300 text-sm">
          <p>&copy; ${new Date().getFullYear()} Hotel Termal Peshkopi. ${t('footer.rights')}.</p>
        </div>
      </div>
    </footer>
  `;
}

function renderFloatingButtons() {
  return `
    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-50">
      <a href="viber://chat?number=%2B355684340580" 
         class="w-14 h-14 bg-purple-600 hover:bg-purple-700 text-white rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition transform hover:scale-110"
         title="Viber">
        <i class="fab fa-viber text-2xl"></i>
      </a>
      <a href="https://wa.me/355684340580" 
         target="_blank"
         class="w-14 h-14 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition transform hover:scale-110"
         title="WhatsApp">
        <i class="fab fa-whatsapp text-2xl"></i>
      </a>
    </div>
  `;
}

// ============== EVENT HANDLERS ==============
window.changeLang = (lang) => {
  currentLang = lang;
  localStorage.setItem('lang', lang);
  renderApp();
};

// Availability form handler
document.addEventListener('submit', async (e) => {
  if (e.target.id !== 'availability-form') return;
  e.preventDefault();
  
  const checkIn = document.getElementById('checkin').value;
  const checkOut = document.getElementById('checkout').value;
  const guests = parseInt(document.getElementById('guests').value);
  const resultDiv = document.getElementById('availability-result');
  
  if (!checkIn || !checkOut) {
    resultDiv.innerHTML = `<p class="text-amber-600 font-medium"><i class="fas fa-exclamation-circle mr-2"></i>${t('hero.selectDates')}</p>`;
    resultDiv.classList.remove('hidden');
    return;
  }
  
  try {
    const res = await fetch('/api/check-availability', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ checkIn, checkOut, guests })
    });
    const data = await res.json();
    
    if (data.available) {
      resultDiv.innerHTML = `
        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
          <p class="text-emerald-700 font-medium"><i class="fas fa-check-circle mr-2"></i>${t('hero.available')}</p>
          <p class="text-sm text-emerald-600 mt-1">${data.count} dhoma tÃ« disponueshme</p>
          <a href="#rooms" class="inline-block mt-3 text-emerald-700 font-semibold hover:underline">
            <i class="fas fa-arrow-right mr-1"></i>Shiko dhomat
          </a>
        </div>
      `;
    } else {
      resultDiv.innerHTML = `
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <p class="text-red-700 font-medium"><i class="fas fa-times-circle mr-2"></i>${t('hero.notAvailable')}</p>
        </div>
      `;
    }
    resultDiv.classList.remove('hidden');
  } catch (error) {
    console.error('Error checking availability:', error);
  }
});

// Set minimum dates for date inputs
document.addEventListener('DOMContentLoaded', () => {
  const today = new Date().toISOString().split('T')[0];
  setTimeout(() => {
    const checkinInput = document.getElementById('checkin');
    const checkoutInput = document.getElementById('checkout');
    if (checkinInput) checkinInput.min = today;
    if (checkoutInput) checkoutInput.min = today;
  }, 100);
});

// ============== INITIALIZE ==============
async function init() {
  await fetchData();
  renderApp();
}

init();
